!function(a){function b(a){var b=this;this.request=indexedDB.open(this.name,this.version),this.request.onsuccess=function(c){b.dbReady=!0,b.db=this.result,b.db.onerror=function(b){a(b.target.error)},b.actionsToBeExecuted.forEach(function(a){a(b.db)}),b.actionsToBeExecuted.length=0,a&&a(null,c.target.result)},this.request.onerror=function(b){a&&a(b.target.error)},this.request.onupgradeneeded=function(a){var c,d=a.target.result;b.tablesToBeAdded.forEach(function(a){c=a.tableName,delete a.name,d.createObjectStore(c,a)}),b.tablesToBeAdded.length=0,b.tablesToBeRemoved.forEach(function(a){d.deleteObjectStore(a)}),b.tablesToBeRemoved.length=0,console.log("UPGRADE DONE")}}function c(a,b){this.dbReady?b(this.db.transaction(a,"readwrite")):this.actionsToBeExecuted.push(function(c){b(c.transaction(a,"readwrite"))})}function d(a,b){this.getTransaction(a,function(c){b(c.objectStore(a))})}function e(a,b){var c=[];this.getTable(a,function(a){a.openCursor().onsuccess=function(a){var d=a.target.result;d?(c.push(d.value),d.continue()):b(c)}})}function f(a){return this.tablesToBeAdded.push(a),this}function g(a){return this.tablesToBeRemoved.push(a),this}function h(a,b){this.db=null,this.name=a,this.version=b,this.request=null,this.dbReady=!1,this.tablesToBeAdded=[],this.tablesToBeRemoved=[],this.actionsToBeExecuted=[]}a.indexedDB||(a.indexedDB=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.msIndexedDB),h.prototype={open:b,addTable:f,removeTable:g,getTransaction:c,getTable:d,query:e},a.zonDB=h}(this);